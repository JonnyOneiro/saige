<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>PHP React Starter</title>
    <script src="https://code.jquery.com/jquery-3.1.0.js"></script>
    <link rel="icon" href="/dist/php-react.png">

    <script>
    $(document).ready(startApp);

    function startApp(){
        $("#login").click(login);
        $("#logout").click(logout);
        checkLoginStatus();
    }
    
    function checkLoginStatus(){
        $.ajax({
            url: 'check_login.php',
            cache: false, //check
            method: 'post',
            dataType: 'json'
        }).then(handleLoginStatusChanged)
    }
    
    function handleLoginStatusChanged(data){
        console.log(data);
        if(data.loggedin){//check
            console.log(data.loggedin);
            $("#userData").show();
            $("#greeting").text(`Welcome back, ${data.userData.userData.username}`);
            $("#loginForm").hide();
        } else {
            $("#userData").hide();
            $("#loginForm").show();
        }
    }

    function logout(){
        $.ajax({
            url: 'logout.php',
            cache: false,
            method: 'post',
            dataType: 'json'
        }).then(handleLoginStatusChanged)
    }

    function login(){
        var username = $("input[name=username").val();
        var password = $("input[name=password").val();

        console.log('login clicked');

        $.ajax({
            url: 'login.php',
            cache: false,
            data: {
                name: username,
                pass: password
            },
            method: 'post',
            dataType: 'json'
        }).then(handleLoginStatusChanged)

    }



    </script>
</head>
<body>
    <!-- <div id="root"></div>
    <script src="/dist/bundle.js"></script> -->
    <div id="userData">
        <div id="greeting">Welcome, user</div><button id="logout">logout</button>
    </div>
    <div id="loginForm">
        <input type="text" name='username' value=''>
        <input type="password" name="password" value="">
        <button id="login">Submit</button>
    </div>

</body>
</html>